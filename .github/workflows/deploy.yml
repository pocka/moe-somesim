name: ãƒ‡ãƒ—ãƒ­ã‚¤

on:
  # `master` ãƒ–ãƒ©ãƒ³ãƒã«pushã—ãŸéš›
  push:
    branches:
      - master
  # æ‰‹å‹•å®Ÿè¡Œã•ã‚ŒãŸéš›
  workflow_dispatch:

# GitHub Pages ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã«å¿…è¦ãªæ¨©é™ã‚’ `GITHUB_TOKEN` ã«è¨­å®š
permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "deploy"
  # å¾Œç¶šã®ã‚¸ãƒ§ãƒ–ãŒèµ°ã‚Šå§‹ã‚ãŸã‚‰å…ˆã«å®Ÿè¡Œã—ã¦ã„ã‚‹æ–¹ã‚’ä¸­æ–­ã™ã‚‹
  cancel-in-progress: true

jobs:
  deloy-ghpages:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    name: GitHub Pages ã¸ãƒ‡ãƒ—ãƒ­ã‚¤
    runs-on: ubuntu-latest
    steps:
      - name: "ğŸ“¦ ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ"
        uses: actions/checkout@v3

      - name: "ğŸ“¦ Node.jsã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—"
        uses: actions/setup-node@v3
        with:
          node-version: "18.6.0"

      - name: "ğŸ“¦ Denoã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—"
        uses: denoland/setup-deno@v1
        with:
          deno-version: v1.29.x

      - name: "ğŸ“¦ npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
        run: npm ci

      - name: "ğŸ“¦ Elmã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—"
        uses: jorelali/setup-elm@v3

      - name: "ğŸ“¦ GitHub Pagesã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—"
        uses: actions/configure-pages@v2

      - name: "ğŸ› ï¸ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ“ãƒ«ãƒ‰"
        # NOTE: ãƒªãƒã‚¸ãƒˆãƒªåã‚’å¤‰ãˆãŸéš›ã¯ `--base=` ã®å€¤ã‚’å¤‰ãˆã‚‹å¿…è¦ãŒã‚ã‚‹
        run: npm run build -- --base=/moe-somesim/

      - name: "ğŸ› ï¸ ãƒ“ãƒ«ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰"
        uses: actions/upload-pages-artifact@v1
        with:
          path: "./dist"

      - name: "ğŸš€ GitHub Pagesã¸ãƒ‡ãƒ—ãƒ­ã‚¤"
        id: deployment
        uses: actions/deploy-pages@v1
